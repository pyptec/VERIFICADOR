C51 COMPILER V9.59.0.0   ACCESCAN                                                          07/28/2021 11:20:15 PAGE 1   


C51 COMPILER V9.59.0.0, COMPILATION OF MODULE ACCESCAN
OBJECT MODULE PLACED IN .\Objects\Accescan.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE Accescan.c LARGE OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Lis
                    -tings\Accescan.lst) TABS(2) OBJECT(.\Objects\Accescan.obj)

line level    source

   1          #include <Accescan.h>
   2          #include <reg51.h>
   3          #include <string.h>
   4          extern void Block_write_clock_ascii(unsigned char *datos_clock);
   5          extern void PantallaLCD(unsigned char cod_msg);
   6          extern void Reloj_Pantalla_Lcd();
   7          extern unsigned char rx_Data(void);
   8          extern void Debug_txt_Tibbo(unsigned char * str);
   9          extern void DebugBufferMF(unsigned char *str,unsigned char num_char,char io);
  10          extern void Debug_Dividir_texto();
  11          extern void tx_aux(unsigned char caracter);
  12          extern unsigned char Dir_board();
  13          extern void Block_read_clock_ascii(unsigned char *datos_clock);
  14          extern void Two_ByteHex_Decimal(unsigned char *buffer,unsigned char id_h,unsigned char id_l);
  15          extern void ByteHex_Decimal(unsigned char *buffer,unsigned char valorhex);
  16          extern void PantallaLCD(unsigned char cod_msg);
  17          extern void LCD_txt (unsigned char * msg,char enable_char_add );
  18          extern unsigned char  ValidaSensoresPaso(void);
  19          extern void tx_aux(unsigned char caracter);
  20          extern void PantallaLCD_LINEA_2(unsigned char cod_msg, unsigned char *buffer);
  21          extern unsigned char hex_bcd (unsigned char byte);
  22          extern void Trama_pto_Paralelo_P(unsigned char *buffer_S1_B0,unsigned char *buffer_S1_B2,unsigned char cmd
             -);
  23          extern void  send_port(unsigned char *buffer_port, unsigned char length_char);
  24          extern unsigned char validar_clk(unsigned char *datos_clock);
  25          extern void Debug_chr_Tibbo(unsigned char Dat);
  26          extern unsigned char rd_eeprom (unsigned char control,unsigned int Dir); 
  27          extern unsigned char Dir_Board_Monitor();
  28          extern void Formato_eeprom();
  29          
  30          
  31          extern unsigned int Timer_tivo;
  32          extern unsigned char Timer_wait;
  33          extern unsigned char Tipo_Vehiculo;
  34          extern unsigned char ValTimeOutCom;
  35          
  36          extern unsigned char  Debug_Tibbo;
  37          extern unsigned char buffer_S_B[17];
  38          sbit rx_ip = P0^0;        
  39          sbit lock = P1^7;           //Relevo 
  40          sbit Atascado = P0^3;       //Rele de on/off del verificador o transporte
  41          sbit led_err_imp = P0^2;      //Error   
  42          
  43          
  44          #define STX                     02 
  45          #define ETX                     03 
  46          
  47          /*MENSAJES PRIMARIO CON CMD DE MSJ*/
  48          #define PRMR_ON_LINE                0xB7
  49          #define PRMR_OFF_LINE               0xb6
  50          #define PRMR_BIENVENIDO             0X02    //FE
  51          #define PRMR_SIN_PAGO               0XE7
  52          #define PRMR_NO_IN_PARK             0XB2
  53          #define PRMR_GRACIAS                'V'
C51 COMPILER V9.59.0.0   ACCESCAN                                                          07/28/2021 11:20:15 PAGE 2   

  54          #define PRMR_ERROR_LOOP             06          //0XE0
  55          #define PRMR_EXPIRO                 0XB4
  56          #define PRMR_EXCEDE_HORARIO         0X07
  57          #define PRMR_NO_MENSUAL             0XB1
  58          #define PRMR_DIREJASE_A_CAJA        0XA1
  59          #define PRMR_MENSUAL_NO_PAGO        0X08
  60          #define PRMR_UN_MOMENTO             0X09
  61          #define PRMR_SOLICITA_EVN           0XAA
  62          #define PRMR_MSJ_EXCLUSIVO          0X55
  63          /*mensaje de mensual*/
  64          #define GRACIAS                 91            //0XFF,01
  65          #define LECTURA_WIEGAND         92//0xB0
  66          #define NO_IN_PARK              93  
  67          #define EXPIRO                  94            //B4
  68          #define EXCEDE_HORARIO          95
  69          #define NO_MENSUAL_NI_PREPAGO   96
  70          #define DIREJASE_A_CAJA         90
  71          #define MENSUAL_NO_PAGO         97
  72          /*mensaje informativo DE PANTALLAS*/
  73          #define ERROR_LOOP              171         //0XE0
  74          #define OFF_LINE                174
  75          #define UN_MOMENTO              175
  76          /*direcciones de eeprom*/
  77          #define EE_USE_LPR            0x000A
  78          #define EE_DEBUG              0x0008
  79          /*define variables de esta funcion*/
  80           unsigned char USE_LPR;
  81           idata unsigned char placa[]={0x30,0x30,0x30,0x30,0x30,0x30,0x0,0x0,0x0};
  82           
  83           /*externos bits*/
  84          
  85          extern bit placa_ready;
  86           enum Tipos_MF_TIPO_TARJETA{
  87            INACTIVA,         
  88            ROTACION,           
  89            MENSUALIDAD,
  90            PREPAGO,
  91            CORTESIA,
  92            LOCATARIO,
  93            TARJETA_PERDIDA = 0X10,
  94            INHABILITADA = 0X11
  95          };
  96           enum expedidor {
  97           fecha_Int_Ano,
  98           fecha_Int_Mes, 
  99           fecha_Int_Dia, 
 100           fecha_Int_Hora,
 101           fecha_Int_Min,   
 102           Tipo_Tarjeta,
 103           Apb,
 104           Horario,
 105           Pico_Placa,
 106           Type_Vehiculo,
 107           Uid_0,
 108           Uid_1,
 109           Uid_2,
 110           Uid_3,
 111           Expira_ano,
 112           Expira_mes,
 113           Expira_dia
 114           
 115          };
C51 COMPILER V9.59.0.0   ACCESCAN                                                          07/28/2021 11:20:15 PAGE 3   

 116          
 117          //unsigned char S1_B2[]={0x13, 0x03, 0x1D, 0x0B, 0x0E, 00, 00, 00, 00, 00, 0x01, 0x13, 0x03, 0x1D, 0x0E, 0
             -x1D};
 118          //unsigned char S1_B0[]={0x32, 0x31, 0x30, 0x37, 0x31, 0x35, 00, 00, 00, 00, 00, 00, 00, 00, 00, 01};
 119          //unsigned char S_B[]={0xE7, 00, 00, 00, 00, 00, 00, 00, 00, 00, 01};
 120          /*------------------------------------------------------------------------------
 121          Rutina q valida los cmd del pto paralelo
 122          temp= usado para contar 20 fuera de linea y mostralo en la pantalla
 123          ------------------------------------------------------------------------------*/
 124          void Valida_Trama_Pto(unsigned char *buffer, unsigned char length_trama)
 125          {
 126   1        
 127   1         static unsigned char cont;
 128   1         unsigned char bcc=0;
 129   1         unsigned char j; 
 130   1         unsigned char buff[11];
 131   1        USE_LPR=rd_eeprom(0xa8,EE_USE_LPR);
 132   1        /*-------------------------------CMD H reloj para el board y la pantalla lcd-----------------------------
             --------------*/
 133   1          if((length_trama==26)&&(*buffer==STX)&&(*(buffer+2)=='H')&&*(buffer+(length_trama-2))==ETX)                         
             -/*cmd de Accescan que me envia el reloj actualizado*/
 134   1          { 
 135   2            Debug_txt_Tibbo((unsigned char *) "primario BCC= ");
 136   2            Debug_chr_Tibbo(*(buffer+25));
 137   2            Debug_txt_Tibbo((unsigned char *) "\r\n");
 138   2            for (j=0; j<length_trama-1; j++)
 139   2            {
 140   3              bcc=*(buffer+j) ^ bcc;
 141   3            }
 142   2            Debug_txt_Tibbo((unsigned char *) "calculo BCC= ");
 143   2            Debug_chr_Tibbo(bcc);
 144   2            Debug_txt_Tibbo((unsigned char *) "\r\n");
 145   2              if (bcc == *(buffer+25))
 146   2            {
 147   3              
 148   3            
 149   3              if(validar_clk(buffer+3)==0)
 150   3              {
 151   4              Block_write_clock_ascii(buffer+3);                                                                                /* se escribe el reloj de ha
             -rdware*/
 152   4          
 153   4              Reloj_Pantalla_Lcd();                                                                                             /* Escribo el reloj en la pantalla
             - lcd*/
 154   4            
 155   4              } 
 156   3            }
 157   2              else
 158   2            {
 159   3              
 160   3              buff[0]=02;
 161   3              buff[1]=05;
 162   3              buff[2]=03;
 163   3              buff[3]=0;
 164   3               send_port(buff,4);
 165   3              
 166   3              Debug_txt_Tibbo((unsigned char *) "REENVIAR trama Hora: ");
 167   3              Debug_chr_Tibbo(buff[0]);
 168   3              Debug_chr_Tibbo(buff[1]);
 169   3              Debug_chr_Tibbo(buff[2]);
 170   3              Debug_txt_Tibbo((unsigned char *) "\r\n");
 171   3            }
 172   2            
C51 COMPILER V9.59.0.0   ACCESCAN                                                          07/28/2021 11:20:15 PAGE 4   

 173   2          }
 174   1          /*-------------------------------CMD B6 fuera de linea -------------------------------------------------
             -------------*/
 175   1          else if(*buffer==PRMR_OFF_LINE)                                                                                   /*cmd de Accescan que dice q es
             -ta fuera de linea*/
 176   1          {
 177   2              cont++;
 178   2              if (cont>4)     /* con un tiempo de retardo =((1/(22118400/12)*65535)*30)*/
 179   2              {
 180   3              PantallaLCD(OFF_LINE);
 181   3              led_err_imp=0;                                                                                                  /*error led on*/
 182   3              Timer_wait=0;
 183   3              lock=0;                                                                                                         /*relevo off despues de 1 minuto*/
 184   3              Atascado=0; 
 185   3              cont=0;
 186   3              }
 187   2          }
 188   1          /*-------------------------------CMD B7 en linea (AA) NO SE SABE  --------------------------------------
             -----------------------------*/
 189   1          else if ((*buffer==PRMR_ON_LINE)  ||(*buffer==PRMR_SOLICITA_EVN) )                                                                              
             -      /*en linea*/
 190   1          {   
 191   2            
 192   2            if (Timer_wait>=20)                                                                                               /* se envia el msj fuera de linea*/
 193   2            { 
 194   3              Timer_wait=0;                                                                                                   /*se inicia el timer*/
 195   3              lock=0;
 196   3              led_err_imp=1;                                                                                                  /*relevo off despues de 1 minuto*/
 197   3              Atascado=0; 
 198   3            } 
 199   2            
 200   2            if ((Debug_Tibbo==0)&&(USE_LPR==1)&& (Timer_tivo>=600))
 201   2            {
 202   3              Timer_tivo=0;
 203   3              Debug_Tibbo=1;
 204   3              Debug_txt_Tibbo((unsigned char *) "LIVE");
 205   3              Debug_Tibbo=0;
 206   3            }
 207   2            
 208   2            
 209   2          } 
 210   1          
 211   1            /*-------------------------------CMD B1 PRMR_NO_MENSUAL_NI PREPAGO ------------------------------------
             ------------------------------*/
 212   1          else if ((*buffer==PRMR_NO_MENSUAL) )                                                                                   /*en linea*/
 213   1          {
 214   2            PantallaLCD(NO_MENSUAL_NI_PREPAGO);                                                                                           /*MSJ MENSUAL NO EN PA
             -RQUEADERO*/
 215   2          }   
 216   1            /*-------------------------------CMD B2 PRMR_NO_IN_PARK   ---------------------------------------------
             ---------------------*/
 217   1          else if ((*buffer==PRMR_NO_IN_PARK) )                                                                                   /*en linea*/
 218   1          {
 219   2            PantallaLCD(NO_IN_PARK);                                                                                            /*MSJ MENSUAL NO EN PARQUEADERO*/
 220   2          }   
 221   1            /*-------------------------------CMD A1    DIREJASE_A_CAJA                ------------------------------
             -------------------------------------*/
 222   1          else if ((length_trama==1)&&(*buffer==PRMR_DIREJASE_A_CAJA  ))                                                                        /*cmd 0
             -xA1 audio caja que es igual a no registra pago */
 223   1          {
 224   2               PantallaLCD(DIREJASE_A_CAJA);
 225   2          }
C51 COMPILER V9.59.0.0   ACCESCAN                                                          07/28/2021 11:20:15 PAGE 5   

 226   1          
 227   1            /*-------------------------------CMD 06  error de loop    ---------------------------------------------
             ----------------------*/
 228   1          else if ((length_trama==1)&&(*buffer==PRMR_ERROR_LOOP))                                                                   /*cmd 0xA1 audi
             -o caja que es igual a no registra pago */
 229   1          {
 230   2               PantallaLCD(ERROR_LOOP);
 231   2          }
 232   1          
 233   1              /*-------------------------------CMD 07  EXCEDE_HORARIO   --------------------------------------------
             -----------------------*/
 234   1          else if ((length_trama==1)&&(*buffer==PRMR_EXCEDE_HORARIO))                                                                   /*cmd 0xA1 
             -audio caja que es igual a no registra pago */
 235   1          {
 236   2               PantallaLCD(EXCEDE_HORARIO);
 237   2          }
 238   1          
 239   1      
 240   1              /*-------------------------------CMD 08 MENSUAL_NO_PAGO   --------------------------------------------
             -----------------------*/
 241   1          else if ((length_trama==1)&&(*buffer==PRMR_MENSUAL_NO_PAGO))                                                                    /*cmd 0xA1
             - audio caja que es igual a no registra pago */
 242   1          {
 243   2               PantallaLCD(MENSUAL_NO_PAGO);
 244   2          } 
 245   1        
 246   1          /*-------------------------------CMD 09 UN_MOMENTO     --------------------------------------------------
             -----------------*/
 247   1          else if ((length_trama==1)&&(*buffer==PRMR_UN_MOMENTO ))                                                                    /*cmd 0xA1 aud
             -io caja que es igual a no registra pago */
 248   1          {
 249   2               PantallaLCD(NO_IN_PARK );
 250   2          }     
 251   1            /*-------------------------------CMD B4  EXPIRO mensualidad vencida -----------------------------------
             ------------------------*/
 252   1          else if ((length_trama==1)&&(*buffer==PRMR_EXPIRO))                                                                   /*cmd 0xA1 audio ca
             -ja que es igual a no registra pago */
 253   1          {
 254   2               PantallaLCD(EXPIRO);                                                                                             /*mesualidad vencida*/
 255   2          }
 256   1            /*------------------------------- CMD 55 PRMR_MSJ_EXCLUSIVO  ------------------------------------------
             -------------------------*/
 257   1          else if ((length_trama==3)&&(*(buffer+1)==PRMR_MSJ_EXCLUSIVO)&&*(buffer+(length_trama-1))==ETX)                 
             -                                                      /* */
 258   1          {
 259   2               Formato_eeprom();                                                                                            /*mesualidad vencida*/
 260   2          } 
 261   1          /*-------------------------------CMD 'V'=PRMR_GRACIAS  msj Gracias y nombre del mensual-----------------
             -------------------------*/
 262   1          else if ((length_trama==19)&& (*(buffer+1)==PRMR_GRACIAS)&&*(buffer+(length_trama-1))==ETX)                         
             -/*cmd 0xA1 audio caja que es igual a no registra pago */
 263   1          {
 264   2              
 265   2                *(buffer+(length_trama-1))= 0;
 266   2                
 267   2               PantallaLCD_LINEA_2(GRACIAS,buffer+2);                                                                     /*SE ENVIA EL MSJ GRACIAS lo
             - q envia el software*/
 268   2          }
 269   1          
 270   1          /*-------------------------------CMD de wiegand---------------------------------------------------*/
 271   1          else if ((length_trama==6)&&(*buffer==STX)&&(*(buffer+1)=='W')&&*(buffer+(length_trama-1))==ETX)                
             -    /* cmd q comunica con monitor por wiegand*/
C51 COMPILER V9.59.0.0   ACCESCAN                                                          07/28/2021 11:20:15 PAGE 6   

 272   1          {
 273   2              /*-------------------------------se covierte el numero serie de la tarjeta----------------------------
             ---*/
 274   2                    ByteHex_Decimal(buff,*(buffer+2));                                                                        /*convierto el primer byte_he
             -x a decimal    */
 275   2                    buff[3]=' ';
 276   2                    Two_ByteHex_Decimal(buff+4,*(buffer+3),*(buffer+4)) ;                                                     /*convierto un byte
             - de 16 bits a decimal*/   
 277   2              /*----------------------------------------------------------------------------------------------------
             ---*/
 278   2                
 279   2            if (USE_LPR==1)
 280   2              {
 281   3                    /*-------------------------------mensaje en la pantalla -------------------------------------------
             --*/
 282   3                    /*ValidaSensoresPaso=0 no hay presencia  ValidaSensoresPaso=0xff  hay presencia*/
 283   3                    if (ValidaSensoresPaso()!= 0xff)
 284   3                    {               
 285   4                      PantallaLCD(ERROR_LOOP);
 286   4                      PantallaLCD_LINEA_2(LECTURA_WIEGAND,buff);                                                                /*msj rasberry*/
 287   4                    }
 288   3                    else
 289   3                    {
 290   4                      Cmd_LPR_Salida_wiegand(buff);
 291   4                      PantallaLCD_LINEA_2(LECTURA_WIEGAND,buff);                                                                /*msj rasberry*/
 292   4                    }
 293   3                
 294   3                    
 295   3                                                                                                                              /*transmito el codigo de la tarjeta a la panta
             -lla lcd*/
 296   3                                
 297   3              }                                                                             
 298   2              
 299   2              else
 300   2              {
 301   3                 /*-------------------------------mensaje en la pantalla---------------------------------------------
             -------*/
 302   3                                                                    
 303   3                    if (ValidaSensoresPaso()!= 0xff)
 304   3                    {               
 305   4                      PantallaLCD(ERROR_LOOP);
 306   4                    }
 307   3                    PantallaLCD_LINEA_2(LECTURA_WIEGAND,buff);                                                                /*transmito el codigo de 
             -la tarjeta a la pantalla lcd*/
 308   3                                                                                                          
 309   3                /*---------------------------------------------------------------------------------------------------
             ------*/  
 310   3              
 311   3              }
 312   2          }
 313   1          
 314   1      }
 315          /*------------------------------------------------------------------------------
 316          Rutina q recibe  los cmd de Monitor por el tibbo
 317          return el num de caracteres recibidos
 318          y almacena la trama en un apuntador
 319          ------------------------------------------------------------------------------*/
 320          unsigned char recibe_cmd_Monitor(unsigned char *buffer_cmd)
 321          {
 322   1        unsigned char j, NumDatos,time_out,MaxChrRx;
 323   1        unsigned int contador;
 324   1        
C51 COMPILER V9.59.0.0   ACCESCAN                                                          07/28/2021 11:20:15 PAGE 7   

 325   1          NumDatos=0;
 326   1          MaxChrRx=11;
 327   1      
 328   1        if (USE_LPR==1)
 329   1        {
 330   2            for (j=0; j<MaxChrRx; j++)
 331   2            {
 332   3              contador=0;
 333   3              time_out=0;
 334   3              while ((rx_ip==1)&&(time_out==0))
 335   3              {
 336   4                contador++;
 337   4                if (contador>20000)
 338   4                {
 339   5                  time_out=1;
 340   5                  j=MaxChrRx;
 341   5                }       
 342   4              }
 343   3              if(time_out==1)break;
 344   3                NumDatos++;
 345   3                *buffer_cmd=rx_Data();
 346   3                  buffer_cmd++;
 347   3            }
 348   2      
 349   2            *buffer_cmd=0;
 350   2            
 351   2      
 352   2        }
 353   1        return  NumDatos;
 354   1      } 
 355          /*------------------------------------------------------------------------------
 356          Rutina q valida los cmd de Monitor
 357          ------------------------------------------------------------------------------*/
 358          /*
 359          void Valida_Trama_Monitor(unsigned char *buffer, unsigned char length_trama)
 360          {   
 361            unsigned char j=0;
 362            unsigned char p=2;
 363            length_trama=1;
 364              if  ((*(buffer+2)==ETX)&&(*(buffer+1)=='P'))                                                                            // APERTURA DE BARRETA
             - 
 365                  {
 366                    lock=1;                                                                                                         //habilita el relevo ON
 367                    Timer_wait=0;
 368                  }
 369                else if (*(buffer+1)=='<')
 370              {
 371                /*placa*/
 372          /*      do
 373                {
 374                  placa[j]=*(buffer+p);
 375                  p++;
 376                  j++;
 377                }while (*(buffer+p) != ETX);
 378                *(buffer+p)=0;
 379                  placa[j-1]=0;
 380                  placa_ready=1;
 381                ValTimeOutCom=10;
 382                /*placa no play <NO_PLATE>*/ 
 383            /*    
 384              }
 385              else if (*(buffer+1)=='[')
C51 COMPILER V9.59.0.0   ACCESCAN                                                          07/28/2021 11:20:15 PAGE 8   

 386              {
 387                /*cancel*/
 388                /*
 389              }
 390          }
 391          */
 392          /*------------------------------------------------------------------------------
 393          
 394          ------------------------------------------------------------------------------*/
 395          /*
 396          void clear_placa()
 397          {
 398            unsigned char i;
 399            for(i=0;i<6;i++)
 400            {
 401             placa[i]=0x30;
 402            }
 403           placa_ready=0;
 404          }
 405            */
 406          /*------------------------------------------------------------------------------
 407          Transmito un caracter al software monitor 
 408          ------------------------------------------------------------------------------*/
 409          void Monitor_chr (unsigned char *str,unsigned char num_char)
 410          {
 411   1        unsigned char j;
 412   1        for (j=0; j<num_char; j++)
 413   1          {
 414   2          tx_aux(*str);
 415   2          str++;
 416   2          }
 417   1      }
 418            
 419          /*------------------------------------------------------------------------------
 420          Transmito CMD de salida wiegand 
 421          ------------------------------------------------------------------------------*/
 422          void Cmd_LPR_Salida_wiegand(unsigned char *buffer)
 423          {
 424   1        unsigned char Buffer_Lpr[30];
 425   1        unsigned char j=3;
 426   1        Buffer_Lpr[0]=STX;                                      /*inicio de cmd STx*/
 427   1        Buffer_Lpr[1]=Dir_Board_Monitor();                      //Dir_board();                              /*direccion de la tarjeta*/
 428   1        Buffer_Lpr[2]='S';                                      /*cmd S que salida wiegand*/
 429   1        if(Tipo_Vehiculo!=0)                                    /*Tipo de vehiculo*/
 430   1          {
 431   2            Buffer_Lpr[j++]='M';                                /*moto*/
 432   2          }
 433   1          else
 434   1          {
 435   2            Buffer_Lpr[j++]='C';                                /*carro*/
 436   2          }
 437   1        
 438   1          
 439   1          
 440   1          for (j=4; *buffer != '\0'; j++)                       /*numero del tab o tarjeta Mf*/
 441   1            {
 442   2                Buffer_Lpr[j]=*buffer;
 443   2                buffer++;
 444   2              
 445   2            }
 446   1            Buffer_Lpr[j++]=':';                                /*separador del tab  o tarjeta MF*/
 447   1                        
C51 COMPILER V9.59.0.0   ACCESCAN                                                          07/28/2021 11:20:15 PAGE 9   

 448   1            Block_read_clock_ascii(Buffer_Lpr+j);               /*año,mes,dia,hora,minutos,*/
 449   1            Buffer_Lpr[j+10]=':';                               /*separador fecha*/
 450   1            Buffer_Lpr[j+11]=ETX;                               /*fin de la trama*/
 451   1          
 452   1                
 453   1          
 454   1            Monitor_chr(Buffer_Lpr,j+12);                       /*rutina de envio de la trama a monitor*/
 455   1      }
 456          /*------------------------------------------------------------------------------
 457          
 458          ------------------------------------------------------------------------------*/
 459          void Cmd_LPR_Salida(unsigned char *buffer_S1_B0,unsigned char *buffer_S1_B)
 460          {
 461   1        
 462   1        
 463   1        unsigned char Buffer_Lpr[30];
 464   1        unsigned char j=3;
 465   1        Buffer_Lpr[0]=STX;                                /*inicio de cmd STx*/
 466   1        Buffer_Lpr[1]=Dir_Board_Monitor();                  //Dir_board();                        /*direccion de la tarjeta*/
 467   1        Buffer_Lpr[2]='S';                                /*numero de digitos de transmicion NO IMPORTA NO ES VALIDADO EN PRINCIP
             -AL*/
 468   1      
 469   1        /*Tipo de vehiculo*/
 470   1        
 471   1          if(buffer_S_B[8] != 0)                        
 472   1          {
 473   2            Buffer_Lpr[j++]='M';                          /*moto*/
 474   2          }
 475   1          else
 476   1          {
 477   2            Buffer_Lpr[j++]='C';                          /*carro*/
 478   2          }
 479   1        if(*(buffer_S1_B0 + Tipo_Tarjeta) == MENSUALIDAD)
 480   1        {
 481   2          ByteHex_Decimal(Buffer_Lpr+4,*(buffer_S1_B0 + Uid_2));
 482   2          j=strlen(Buffer_Lpr);
 483   2          Buffer_Lpr[j]= ' ';
 484   2          Buffer_Lpr[j+1]= 0;
 485   2          j=strlen(Buffer_Lpr);
 486   2          Two_ByteHex_Decimal(Buffer_Lpr+j,*(buffer_S1_B0 + Uid_1),*(buffer_S1_B0 + Uid_0));
 487   2            
 488   2        }
 489   1        else
 490   1        {
 491   2        /*ticket o consecutivo*/
 492   2        
 493   2          do
 494   2          {
 495   3          
 496   3          Buffer_Lpr[j++]=*buffer_S1_B;                 /*ticket o consecutivo*/
 497   3          buffer_S1_B++;
 498   3          }while (*buffer_S1_B != 0);
 499   2          
 500   2          Buffer_Lpr[j++]=0;
 501   2        }
 502   1        
 503   1          j=strlen(Buffer_Lpr);
 504   1        
 505   1        
 506   1          Buffer_Lpr[j]=':';                            /*separador de la fecha de entrada*/
 507   1          
 508   1        /*fecha de entrada*/
C51 COMPILER V9.59.0.0   ACCESCAN                                                          07/28/2021 11:20:15 PAGE 10  

 509   1          
 510   1          Block_read_clock_ascii(Buffer_Lpr+j+1);     //leo la fecha de entrada
 511   1            
 512   1          j=strlen(Buffer_Lpr);
 513   1          
 514   1          Buffer_Lpr[j++]=':';                            /*separador tipo fecha*/
 515   1                                                          /**/
 516   1              
 517   1          Buffer_Lpr[j++]=ETX;  
 518   1        
 519   1          Monitor_chr(Buffer_Lpr,j);                        /*rutina de envio de la trama a monitor*/
 520   1      }
 521          
 522            
 523            


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   1903    ----
   CONSTANT SIZE    =     59    ----
   XDATA SIZE       =      2      98
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =      9    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
